<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pd.manage.dao.system.IEmployeeDao">
	
	<select id="findEmployeeById" resultType="com.pd.manage.model.system.EmployeeDto">

		SELECT a.ID id,a.`NAME` name,a.IMG img ,a.EMAIL email,a.PHONE phone,c.AREA area,c.PROVINCE province,
		a.`CODE` code,c.`NAME` dept,d.`NAME` post,concat(e.`NAME`,' ', b.`NAME` ) pname,d.grade grade,a.DEPT_PID deptpid,
		a.DEPT_ID deptid ,a.POST_ID postid,a.PID pid,a.ZHSUSERID zhsuserid,a.RESUME resume,b.DEPT_ID pdeptid  
		,a.EMPL_STATUS emplStatus,a.EMPL_DESC emplDesc, a.SKILL_LEVEL skillLevel,a.letter, a.JOIN_DATE joinDate
		FROM BASE_EMPLOYEE a 
		join BASE_DEPT c on c.id=a.dept_id and c.IS_DELETE=0 and a.id=#{id} 
		JOIN BASE_POST d on d.id=a.post_id and d.IS_DELETE=0 
		left JOIN BASE_EMPLOYEE b on a.PID=b.ID and b.IS_DELETE=0
		LEFT JOIN BASE_POST e on e.id=b.POST_ID and e.IS_DELETE=0 
		where a.IS_DELETE=0 and a.id=#{id}
	</select>

    <select id="findSysLogin"  resultType="com.pd.manage.model.system.EmployeeDto">
        SELECT B.`NAME` name ,B.EMAIL email,B.ZHSUSERID zhsuserid,
               B.DEPT_ID deptid,C.`NAME` deptName,B.POST_ID postid,D.`NAME` postName,
               B.id empid,B.`STATUS` status,B.IMG img,B.`CODE` code,
               C.PROVINCE provinceId,SP.NAME provinceName,SP.AREA_ID areaId,SP.AREA_NAME areaName
        FROM BASE_EMPLOYEE B
            left JOIN BASE_DEPT C ON C.ID=B.DEPT_ID AND C.IS_DELETE=0
            left JOIN BASE_POST D ON D.ID=B.POST_ID AND D.IS_DELETE=0
            left JOIN SYS_PROVINCE SP on C.PROVINCE=SP.ID
        WHERE B.EMAIL=#{email} AND B.`PASSWORD`=#{pwd} and B.USER_TYPE IN(3,#{type})
              AND B.IS_DELETE=0 and B.EMPL_STATUS!=2 LIMIT 1
    </select>

    <select id="findEmployeeByEmail" resultType="com.pd.manage.model.system.EmployeeDto">
        SELECT * FROM BASE_EMPLOYEE a
        where a.IS_DELETE=0 and a.EMAIL=#{email}
    </select>

</mapper>
	

	